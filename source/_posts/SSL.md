---
title: SSL
date: 2022-04-05 18:48:57
tags:
- SSL

categories: 
  - Basic
---

在处理实习的业务需求的时候，涉及到ssl公钥私钥部分的相关知识。本文用以记录与ssl相关的基础知识及其应用。
<center>
        <img src="./SSL/SSL encrypted.jpg" width=80%>
</center>

<!-- more -->

# What is SSL?
安全套接字层 (SSL) 是一种加密安全协议。它最初由 Netscape 于 1995 年开发，旨在确保 Internet 通信中的隐私、身份验证和数据完整性。SSL 是如今使用的现代 TLS 加密的前身。

实施 SSL/TLS 的网站的 URL 中带有“HTTPS”，而不是“HTTP”。

## TLS 握手
> TLS 是一种旨在保护互联网通信安全的加密协议。TLS 握手是启动 TLS 加密通信会话的过程。在 TLS 握手过程中，通信双方交换消息以相互确认，彼此验证，确立它们将使用的加密算法，并生成一致的会话密钥。TLS 握手是 HTTPS 工作原理的基础部分。
<center>
        <img src="./SSL/TLS.jpg" width=80%>
</center>

通过 TCP 握手打开 TCP 连接后，将发生 TLS 握手。

## TLS握手会发生什么
- 指定将要使用的 TLS 版本（TLS 1.0、1.2、1.3 等）
- 决定将要使用哪些密码套件（见下文）
- 通过服务器的公钥和 SSL 证书颁发机构的数字签名来验证服务器的身份
- 生成会话密钥，以在握手完成后使用对称加密

## TLS步骤
TLS 握手的确切步骤将根据所使用的密钥交换算法的类型以及双方支持的密码套件而有所不同。RSA 密钥交换算法最为常用。

1. “客户端问候（client hello）” 消息： 客户端通过向服务器发送“问候”消息来开始握手。该消息将包含**客户端支持的 TLS 版本**，**支持的密码套件**，以及称为一串称为“**客户端随机数（client random）**”的随机字。
2. “服务器问候（server hello）”消息： 作为对 client hello 消息的回复，服务器发送一条消息，内含**服务器的 SSL 证书**、服务器选择的**密码套件**，以及“**服务器随机数**（server random）”，即由服务器生成的另一串随机字节。
3. 身份验证： 客户端使用颁发该证书的证书颁发机构验证服务器的 SSL 证书。此举确认服务器是其声称的身份，且客户端正在与该域的实际所有者进行交互。
4. 预主密钥： 客户端再发送一串随机字节，即“**预主密钥（premaster secret）**”。预主密钥是**使用公钥加密的，只能使用服务器的私钥解密**。（客户端从服务器的 SSL 证书中获得公钥。）
5. 私钥被使用：服务器对预主密钥进行解密
6. 生成会话密钥：**客户端和服务器均使用客户端随机数、服务器随机数和预主密钥生成会话密钥**。双方应得到相同的结果。
7. 客户端就绪：客户端发送一条“已完成”消息，该消息用会话密钥加密。
8. 服务器就绪：服务器发送一条“已完成”消息，该消息用会话密钥加密。
9. 实现安全对称加密：已完成握手，并使用会话密钥继续进行通信。

## Diffie-Hellman 握手过程
所有 TLS 握手均使用非对称加密（公钥和私钥），但并非全都会在生成会话密钥的过程中使用私钥。例如，短暂的 Diffie-Hellman 握手过程如下：
1. 客户端问候：客户端发送客户端问候消息，内含协议版本、客户端随机数和密码套件列表。
2. 服务器问候：服务器以其 SSL 证书、其选定的密码套件和服务器随机数回复。与上述 RSA 握手相比，服务器在此消息中还包括以下内容（步骤 3）：
3. 服务器的数字签名：**服务器使用其私钥对客户端随机数、服务器随机数及其 DH 参数** 进行加密。加密后的数据用作服务器的数字签名，从而确定**服务器具有与 SSL 证书中的公钥相匹配的私钥**。
4. 确认数字签名：客户端使用公钥解密服务器的数字签名，验证服务器控制私钥并且是其声称的身份。客户端 DH 参数：客户端将其 DH 参数发送到服务器。
5. 客户端和服务器计算预主密钥：客户端和服务器使用交换的 DH 参数分别计算匹配的预主密钥，而不像 RSA 握手那样由客户端生成预主密钥并将其发送到服务器。
6. 创建会话密钥：与 RSA 握手中一样，客户端和服务器现在从预主密钥、客户端随机数和服务器随机数计算会话密钥。
7. 客户端就绪：与 RSA 握手相同。
8. 服务器就绪
9. 实现安全对称加密




# 参考文献
[1. Cloudflare 什么是ssl](https://www.cloudflare.com/zh-cn/learning/ssl/what-is-ssl/)
